<!DOCTYPE HTML>
<html>
<head>
   <link rel="shortcut icon" type="x-icon" href="/images/bonfire-darksouls.gif">
   <link rel="stylesheet" href="/Style2.css">
   <link href="https://fonts.cdnfonts.com/css/optimus-princeps" rel="stylesheet">
   <title> Sword Demon: Katanas </title>
</head>

<style>
    body {
      background-image: url('/images/Dark-Souls-фэндомы-Pixel-Art-gif-2464970.gif');
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-position: center;
      background-size: cover;
    }
</style>

<header>
  <h3>
    <div class="container">
      SWORD 
      <a href="#" class="image-button">
        <img src="/images/bonfire-darksouls.gif" onclick="playSound()" style="width:50px;height:50px;" > 
      </a>
      <script> 
        function playSound() {
          var audio = new Audio('/sounds/Bonefire.mp3');
          audio.play();
        }
        function playSound2() {
          var audio = new Audio('/sounds/item-get.mp3');
          audio.play();
        }
      </script>
      DEMON
      <a href="/main_page" class="Button" onmouseenter="playSound2()" target=_self>HOME</a>
      <div class="dropdown" >
        <a href="/store" class="Button" onmouseenter="playSound2()" target=_self>STORE</a>
      </button>
      <div class="dropdown-content">
        <a href="/katanas" class="Button" onmouseenter="playSound2()">Katanas</a>
        <a href="/knives" class="Button" onmouseenter="playSound2()">Knives</a>
        <a href="/armory" class="Button" onmouseenter="playSound2()">Armory</a>
      </div>
    </div>
    <a href="/about" class="Button" onmouseenter="playSound2()" target=_self>ABOUT</a>
    <a href="/contact" class="Button" onmouseenter="playSound2()" target=_self>CONTACT</a>
        <a href="/cart" class="Button" onmouseenter="playSound2()">CART</a>
  </h3>
</header>

<body>


<div class="products">
    
    <% products.forEach(function(product) { %>
        <div class="product">
            <h2> <%= product.name %> </h2>
            <br>
            <a href="#" class="view-details-btn" data-product-id="<%= product.id %>" onmouseenter="playSound2()">
                <img src="<%= product.image_url %>" height="300" alt="<%= product.name %>">
            </a>
            <br>
            <br>
            <h1> <%= product.price %> $</h1> <br>
            
              <h1>
    <button class="Button add-to-cart-btn" data-product-id="<%= product.id %>" onmouseenter="playSound2()">
        ADD TO CART
    </button>
</h1>
            <br>
        </div>
    <% }); %>

<div id="product-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        
        <div id="modal-body-content">
            </div>
    </div>
</div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('product-modal');
        const modalContent = document.getElementById('modal-body-content');
        const closeBtn = document.querySelector('.close-btn');
        const detailButtons = document.querySelectorAll('.view-details-btn');

        detailButtons.forEach(button => {
            button.addEventListener('click', async (e) => {
                e.preventDefault();
                const productId = button.getAttribute('data-product-id');

                try {
                    const response = await fetch(`/api/product/${productId}`);
                    const product = await response.json();

                    if (product.error) {
                        modalContent.innerHTML = `<h2>Помилка: ${product.error}</h2>`;
                    } else {
                        const html = `
                            <h2>${product.name}</h2>
                            <img src="${product.image_url}" height="350" alt="${product.name}" style="margin: 15px auto;">
                            
                            <div class="text_about">
                                <h4>Повний Опис:</h4>
                                <p>${product.description}</p>
                                <hr>

                                <h4>Технічні Характеристики:</h4>
                                <pre>MATERIAL, MM: ${product.material}</pre>
                                <pre><hr>WEIGHT, KG:  ${product.weight_kg}</pre>
                                <pre><hr>ARMOR TYPE:  ${product.armor_type}</pre>
  
                                <hr>
                               <h1>${product.price} $</h1>
                               <h1>
                                 <button id="add-to-cart-btn" 
                                     data-product-id="${product.id}" 
                                     class="Button" 
                                     onmouseenter="playSound2()">
                                   ADD TO CARD
                               </button>
                              </h1>
                            </div>
                        `;
                        modalContent.innerHTML = html;
                        
                        document.getElementById('add-to-cart-btn').addEventListener('click', async (e) => {
                            const id = e.target.getAttribute('data-product-id');
                            
                            const response = await fetch(`/cart/add/${id}`, { method: 'POST' });
                            const data = await response.json();

                            if (data.success) {
                                alert(`Товар успішно додано до кошика! Поточна кількість: ${data.cart.length}`);
                            } else {
                                alert('Помилка додавання до кошика.');
                            }
                        });
                    }

                    modal.style.display = 'block';
                } catch (error) {
                    console.error('Помилка завантаження даних:', error);
                    modalContent.innerHTML = '<h2>Не вдалося завантажити дані продукту.</h2>';
                    modal.style.display = 'block';
                }
            });
        });

        

        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
</script>

<script>
document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', async () => {
        const productId = button.getAttribute('data-product-id');

        try {
            const response = await fetch(`/cart/add/${productId}`, { method: 'POST' });
            const data = await response.json();

            if (data.success) {
                alert(`Товар успішно додано до кошика! Поточна кількість: ${data.cart.length}`);
            } else {
                alert('Помилка додавання товару до кошика.');
            }
        } catch (err) {
            console.error(err);
            alert('Помилка сервера при додаванні товару до кошика.');
        }
    });
});
</script>

</body>